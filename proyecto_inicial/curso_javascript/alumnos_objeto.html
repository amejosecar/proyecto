<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de alumnos</title>
</head>
<body>
    <h1>REVISAR EL CODIGO DE AITOR</h1>
    <p>Alumnos con metodos  objetos
        Constuir un formualrio para miostrar la inofrmacion de los alumnos desde una 
        base de datos, en este caso un array de objetos. El formulario debe tener los siguientes campos:
        <ul>
            
            <li>1. Construir un formulario para introducir datos personales de alumnos:
                Nombre
                Apellidos
                DNI
                Edad (selector)
                Curso (selector de cinco cursos)</li>
                
            <li>2. Guardar los datos del alumno en un objeto verificando.
                    - Que la edad esté entre 18 y 120 años
                    - el DNI tenga 8 dígitos y una letra.</li>
                
            <li>3. Guardar las películas en una lista de alumnos.</li>
            <li>4. Hacer que la lista de alumnos tenga persistencia en el navegador</li>
            <li>5. Renderizar la información de los alumnos en una tabla.
                De manera que los encabezados de la tabla procedan de los campos del objeto alumno.
                </li>       
            <li>6. Modificar el formulario para que utilice la clase Alumno en lugar de objetos. 
                La clase alumno contendrá los verificadores y la lista de cursos.
                    </li>
        </ul>
    </p>
    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" name="nombre"><br><br>

    <label for="apellidos">Apellidos:</label>
    <input type="text" id="apellidos" name="apellidos"><br><br>

    <label for="edad">Edad:</label>
    <input type="number" id="edad" name="edad"><br><br>

    <label for="dni">DNI del Alumno</label>
    <input type="text" id="dni" name="dni"><br><br>

    <!-- Campo para reflejar los géneros seleccionados -->
    <label for="Cursos">Lista de Cursos</label>
    <select id="Cursos" name="Cursos">
        <option value="">Seleccion un curso</option>
        <option value="Curso 1">Curso 1</option>
        <option value="Curso 2">Curso 2</option>
        <option value="Curso 3">Curso 3</option>
        <option value="Curso 4">Curso 4</option>
        <option value="Curso 5">Curso 5</option>
    </select>
<!--     <input type="text" id="selectedCursos" readonly placeholder="Selecciona Cursos" disabled /> -->
    <br>
<br>
    <label for="fecha_nacimiento">Fecha de nacimiento:</label>
    <input type="date" id="fecha_nacimiento" name="fecha_nacimiento"><br><br>

    <label for="sexo">Sexo:</label>
    <select id="sexo" name="sexo">
        <option value="">Selecciona un sexo</option>
        <option value="masculino">Masculino</option>
        <option value="femenino">Femenino</option>
        <option value="no_binario">No binario</option>
        <option value="otro">Otro</option>
        <option value="prefiero_no_decirlo">Prefiero no decirlo</option> 
    </select>
<br>
<br>

<button type="button" id="boton_cargar">Cargar datos</button>
<button type="button" id="boton_reset">Limpiar formulario</button>
<button type="button" id="mostrar_datos">Mostrar datos</button>
<br>
<br>
<h2>Tabla de alumnos</h2>
<div id="tabla_alumnos"></div>

</body>

<script>
/* 





 */

 //funcion cargar la data
/* const cargar_datos = function () {
console.log("Cargar datos"); // Mensaje de depuración
};
 */
 //funcion cargar la data

let lista_alumnos = JSON.parse(localStorage.getItem("lista_alumnos")) || [];

const verificar_edad = function (edad) {
    edad = parseInt(edad); // Obtener el valor del campo "edad"
    if (edad >= 18 && edad <= 70) {
        return edad; // Retornar verdadero si la edad es mayor de 18 y menor o igual a 90
    } else {
        throw Error ("Edad fuera de rango"); // Mostrar alerta si es mayor de edad
    }
};

const verificar_dni = function (dni) {
    dni = dni.toUpperCase(); // Convertir el DNI a mayúsculas
    const expresion = new RegExp("^\\d{8}[A-Z\]$"); // Expresión regular para validar el formato del DNI
    if (expresion.test(dni)) {
        return dni; // Retornar verdadero si el DNI es válido
    } else {
        //console.log(dni); // Mensaje de depuración
        throw Error ("DNI no válido"); // Mostrar alerta si el DNI no es válido
    }
};

const verificar_vacio = function (nombreCampo, valorCampo) {
    if (valorCampo.trim() === "") { // Verificar si el campo está vacío o contiene solo espacios en blanco
        throw Error(`El campo ${nombreCampo} no puede estar vacío`); // Mostrar un mensaje personalizado si está vacío
    } else {
        return valorCampo; // Retornar el valor si no está vacío
    }
};


const cargar_datos = function () {
    let alumno = {}; // Crear un objeto vacío para almacenar los datos del formulario
    try {
        alumno.nombre = verificar_vacio("nombre", document.getElementById("nombre")?.value || "");
        alumno.apellidos = verificar_vacio("apellidos", document.getElementById("apellidos")?.value || "");
        alumno.edad = verificar_vacio("edad", document.getElementById("edad")?.value || ""); // Obtener el valor del campo "edad"
        alumno.dni = verificar_vacio("dni", document.getElementById("dni")?.value || ""); // Obtener el valor del campo "dni"
        alumno.Cursos = verificar_vacio("Cursos", document.getElementById("Cursos")?.value || "");
        alumno.fecha_nacimiento = verificar_vacio("fecha_nacimiento", document.getElementById("fecha_nacimiento")?.value || "");
        alumno.sexo = verificar_vacio("sexo", document.querySelector("#sexo")?.value || ""); //#para uso del querySelector
        alumno.edad = verificar_edad(document.getElementById("edad")?.value || ""); // Validar la edad
        alumno.dni = verificar_dni(document.getElementById("dni")?.value || ""); // Validar el DNI
        console.log(alumno); // Mensaje de depuración
        lista_alumnos.push(alumno); // Agregar el objeto "alumno" al array "lista_alumnos"
        localStorage.setItem("lista_alumnos", JSON.stringify(lista_alumnos));
        // En lugar de alert, se ubica el mensaje en la sección correspondiente:
        document.getElementById("tabla_alumnos").innerHTML =
            `<p>Alumno ${alumno.nombre} ${alumno.apellidos} ha sido procesado exitosamente</p>`;
    } catch (error) {
        alert(error.message); // Mostrar alerta si ocurre un error
    }
};n

// Función para renderizar los datos / mostrar los datos desde el json
                /* const renderizar_datos = function () {
                    console.log(lista_alumnos); // Mostrar el array "lista_alumnos" en la consola
                    lista_alumnos.forEach((element) => {
                        console.log(element.nombre);
                    });
                };
                */
/* // sin los key creando a mano la tabla
 const renderizar_datos = function () {
    const contenedorTabla = document.getElementById("tabla_alumnos");
    contenedorTabla.innerHTML = ""; // Limpiar cualquier tabla previa

    if (lista_alumnos.length === 0) {
        contenedorTabla.innerHTML = "<p>No hay alumnos registrados.</p>";
        return;
    }

    const tabla = document.createElement("table");
    tabla.style.borderCollapse = "collapse";
    tabla.style.width = "75%";

    // Crear encabezados de la tabla
    const encabezados = ["Nombre", "Apellidos", "Edad", "DNI", "Curso", "Fecha de Nacimiento", "Sexo"];
    const encabezadosRow = document.createElement("tr");
    encabezados.forEach(encabezado => {
        const th = document.createElement("th");
        th.textContent = encabezado;
        th.style.border = "1px solid black";
        th.style.padding = "8px";
        th.style.backgroundColor = "#f2f2f2";
        encabezadosRow.appendChild(th);
    });
    tabla.appendChild(encabezadosRow);

    // Crear filas de la tabla con la información de los alumnos
    lista_alumnos.forEach(alumno => {
        const fila = document.createElement("tr");

        Object.values(alumno).forEach(valor => {
            const td = document.createElement("td");
            td.textContent = valor;
            td.style.border = "1px solid black";
            td.style.padding = "8px";
            fila.appendChild(td);
        });

        tabla.appendChild(fila);
    });

    // Agregar la tabla al contenedor
    contenedorTabla.appendChild(tabla);
}; */
// a continuacion se crea la tabla de forma automatica con los key del objeto
const renderizar_datos = function () {
    const contenedorTabla = document.getElementById("tabla_alumnos");
    contenedorTabla.innerHTML = ""; // Limpiar cualquier tabla previa

    if (lista_alumnos.length === 0) {
        contenedorTabla.innerHTML = "<p>No hay alumnos registrados.</p>";
        return;
    }

    const tabla = document.createElement("table");
    tabla.style.borderCollapse = "collapse";
    tabla.style.width = "75%";

    // Crear encabezados de la tabla dinámicamente desde las keys del primer objeto
    const encabezados = Object.keys(lista_alumnos[0]); // Obtener las keys del primer objeto
    const encabezadosRow = document.createElement("tr");

    encabezados.forEach(encabezado => {
        const th = document.createElement("th");
        th.textContent = encabezado.charAt(0).toUpperCase() + encabezado.slice(1); // Capitalizar encabezado
        th.style.border = "1px solid black";
        th.style.padding = "8px";
        th.style.backgroundColor = "#f2f2f2";
        encabezadosRow.appendChild(th);
    });
    tabla.appendChild(encabezadosRow);

    // Crear filas de la tabla con la información de los alumnos
    lista_alumnos.forEach(alumno => {
        const fila = document.createElement("tr");

        encabezados.forEach(key => {
            const td = document.createElement("td");
            td.textContent = alumno[key]; // Usar el valor correspondiente a la key
            td.style.border = "1px solid black";
            td.style.padding = "8px";
            fila.appendChild(td);
        });

        tabla.appendChild(fila);
    });

    // Agregar la tabla al contenedor
    contenedorTabla.appendChild(tabla);
};



 // Función para reiniciar el formulario
const limpiarCampos = function () {
    const ids = ["nombre", "apellidos", "edad", "dni", "Cursos","sexo",  "fecha_nacimiento"];
    
    ids.forEach(id => {
        const elemento = document.getElementById(id);
        if (elemento) {
            elemento.value = ""; // Limpiar el campo
        } else {
            console.warn(`El elemento con ID "${id}" no se encuentra en el DOM.`);
        }
    });

    // Limpiar selector de sexo
    const sexoSelect = document.getElementById("sexo");
    if (sexoSelect) {
        sexoSelect.value = ""; // Resetear el campo "sexo"
    } else {
        console.warn("El elemento con ID 'sexo' no se encuentra en el DOM.");
    }

    // Si hay select múltiple, limpiar opciones seleccionadas
    const cursosSelect = document.getElementById("Cursos");
    if (cursosSelect) {
        Array.from(cursosSelect.options).forEach(option => option.selected = false);
    }
};

 // Eventos para los botones
document.getElementById("boton_reset").addEventListener("click", limpiarCampos); // Asociar el evento al botón de reset
document.getElementById("boton_cargar").addEventListener("click", cargar_datos); //    Asociar el evento al botón de cargar datos
document.getElementById("mostrar_datos").addEventListener("click", renderizar_datos); //    Asociar el evento al botón de cargar datos




</script>



</html>